    - name: Generate posts
      run: |
        slug(){ echo "$1" | tr '[:upper:]' '[:lower:]' |
          sed -E 's/[√†√°√¢√£√§]/a/g;s/[√®√©√™√´]/e/g;s/[√¨√≠√Æ√Ø]/i/g;
                   s/[√≤√≥√¥√µ√∂]/o/g;s/[√π√∫√ª√º]/u/g;
                   s/[^a-z0-9]+/-/g;s/^-+|-+$//g'; }

        for md in drafts/*.md; do
          [ -e "$md" ] || continue

          title=$(head -1 "$md" | sed 's/^# //')
          slug=$(slug "$title")
          date=$(date +%F)
          html="blog/${date}-${slug}.html"

          # markdown ‚Üí HTML
          body=$(pandoc "$md" -t html)

read -r -d '' TEMPLATE <<'EOF'
<!-- /partials/template-post.html ser√° usado abaixo -->
EOF

          # gera o post substituindo marcadores via AWK
          awk -v title="$title" -v body="$body" '
            BEGIN{RS=""; FS="\n"}
            {
              gsub(/<!-- \{\{TITLE\}\} -->/, title)
              gsub(/<!-- \{\{CONTENT\}\} -->/, body)
              print
            }' partials/template-post.html > "$html"

          # ----- atualiza galeria -----
          card="<div class=\"card\"><a href=\"${date}-${slug}.html\">
                   <div class=\"card-title\">${title}</div></a></div>"

          awk -v c="$card" '
            /<!-- posts -->/ { print; print c; next }
            { print }
          ' blog/index.html > blog/index.tmp && mv blog/index.tmp blog/index.html

          # ----- sitemap -----
          grep -q "${date}-${slug}.html" sitemap.xml || \
            sed -i "$ i\\  <url><loc>https://consultoria.leonardograciano.com.br/blog/${date}-${slug}.html</loc></url>" sitemap.xml

          git mv "$md" "drafts/_done_${date}_${slug}.md"
        done

        git config user.name  "blog-bot"
        git config user.email "bot@users.noreply.github.com"
        git add blog/ drafts/ blog/index.html sitemap.xml
        git commit -m "üìù novo post autom√°tico" || echo "nada para commitar"
        git push
